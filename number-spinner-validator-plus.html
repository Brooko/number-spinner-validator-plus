<!--
`number-spinner-validator-plus`
The validator for number-spinner-plus, it contain error and warning rules and control functions

@demo demo/index.html 
-->

<dom-module id="number-spinner-validator-plus">
  <script>
    Polymer({

      is: 'number-spinner-validator-plus',

      // RESET FLAGS FUNCTION
      resetFlags:function() {
        this.errorFlag=false;
        this.warningFlag=false;
      },

      // CHECK IF IS A DISCRETE NUMBER-SPINNER-PLUS
      discrete:function() {
        if(this.allowedNumbers!=null&&this.allowedNumbers!=undefined){
          return true;
        }
        return false;
      },

      // ERRORS CONTROLLER
      controlErrors:function(){  
        console.log("Il valore è "+this.value)   
        // 1. CHECK IF THE VALUE IS IN THE LIST (DISCRETE)
        if(this.discrete()&&this.allowedNumbers.indexOf(this.value)==-1) {
          this.errorFlag=true;
          this.message=this.errors["notInListError"].message;
                  console.log("- "+this.message+" è un errore "+this.errorFlag);
        };

        // 2. CHECK IF THE VALUE IS LESS THAN MIN
        if(this.minError!=null&&this.minError!=undefined&&this.value<this.minError&&(!this.errorFlag)) {
          this.errorFlag=true;
          this.message=this.errors["minExceededError"].message;
                  console.log("- "+this.message+" è un errore "+this.errorFlag);
        };

        // 3. CHECK IF THE VALUE IS MORE THAN MAX
        if(this.maxError!=null&&this.maxError!=undefined&&this.value>this.maxError&&(!this.errorFlag)) {
          this.errorFlag=true;
          this.set("message",this.errors["maxExceededError"].message);
                  console.log("- "+this.message+" è un errore "+this.errorFlag);
        };
      },

      // WARNINGS CONTROLLER
      controlWarnings:function(){
        // 1. CHECK THE BASE
        if(this.stepWarning!=null&&this.stepWarning!=undefined) {
          if(this.value%this.stepWarning!=this.initialValue%this.stepWarning) {
            this.warningFlag=true;
            this.message=this.warnings["notInBaseWarning"].message;            
          };
        };

        // 2. CHECK THE DIGITS ---------- FUTURE FEATURE!!
      },

      // VALUE CONTROLLER
      _controlValue:function (Value) {
        this.resetFlags();
        console.log("Ho resettato i flag");
               console.log("Ho controllato gli errori e:");
        this.controlErrors();

        if(!this.errorFlag) {        
          this.controlWarnings();
        };
      },

      properties: {
        // VALUE TO CONTROL
        value:{
          value:null,
          observer:"_controlValue",
        },

        // ERROR PROPRETIES
        errors:{
          value:{ "notInListError":   { message:"The selected number has not been in the list"  },
                  "minExceededError": { message:"The mininum number has been exceeded"          },                  
                  "maxExceededError": { message:"The maximum number has been exceeded"          }      

          },
        },

        allowedNumbers:{
          type:Array,
          value:null,
        },

        minError:{
          type:Number,
          value:null,
        },

        maxError:{
          type:Number,
          value:null,
        },

        errorFlag:{
          notify:true,
          type:Boolean,
          value:null,
        },

        // WARNING PROPRETIES
        warnings:{
          value:{ "notInBaseWarning":   { message:"The selected number isn't in the base of the spinner"       },
                  "digitsWarning":      { message:"The selected number has too many significant digits, it will consider the first "+this.digitsWarning+"significant digit"  }
          },
        },

        stepWarning:{
          type:Number,
          value:null,
        },

        initialValue:{
          type:Number,
          value:null,
        },

        digitsWarning:{
          type:Number,
          value:null,
        },

        warningFlag:{
          notify:true,
          type:Boolean,
          value:null,
        },

        // MESSAGE TO message-container
        message:{
          notify:true,
          type:String,
          value:null,
        },
      },
    });
  </script>
</dom-module>
